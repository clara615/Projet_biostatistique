---
title: "Projet biostatistique"
author: "Gambardello Clara, Karla Pem"
date: "2025-12-09"
output: pdf_document
---

***Dans toute cette étude les intervalles de confiance et les conclusions statistique se feront avec une confiance de 95%.***

```{r, include=FALSE}
library(ggplot2)
library(dplyr)
library(stringr)
library(MASS)
library(pROC)
```

# Description du jeu de donnée

```{r}
CancerPoumon <- read.csv("CancerPoumongood.csv", sep=";")
head(CancerPoumon)
```

```{r}
# Informations sur la table de donnée
str(CancerPoumon)
```

Notre table de données sur le cancer du poumon contient 550 observations
(Cas + témoin), et 12 varibles.

Les variables sont les suivantes : 
- "statut_cas_temoin" : Précise le groupe de la personne Cas ou Témoin 
- "age", "sexe", "imc" - "region" : Donne la région parmis ("Centre-Val-de-Loire", "Hauts-de-France", "Ile-de-France"). 
- "niveau_etudes" : Donne le niveau d'étude selon 3 modalités ("Primaire","Secondaire", "Supérieur"). 
- "tabagisme" : Donne le statut de l'individu sur le tabac selon 3 modalités ("Ancien fumeur", "Fumeur actuel", "Jamais"). 
- "exposition_professionnelle" : Donne l'exposition au tabac des individus sur leur lieu de travail selon 3 modalités ("Aucune exposition", "Exposition faible", "Exposition importante"). 
- "bronchopneumopathie_chronique" : Présence ou non d’une BPCO ("Oui", "Non"). 
- "exposition_domestique_fumee" : Donne l'exposition domestique à la fumée de tabac ("Oui", "Non").

```{r}
colSums(is.na(CancerPoumon))
```

Il n'y a pas de données manquantes dans la table de données.

```{r}
summary(factor(CancerPoumon$statut_cas_temoin))
```

Dans cette étude on a 230 cas et 320 témoins.

# Quelques statistiques descriptives

A MODIDIER : il faudrait faire apparaitre le fait que + d'homme que de femme, et la proportions dans chaque modalités des variables catécorielle ??

```{r}
ggplot(CancerPoumon, aes(x=niveau_etudes, fill=tabagisme)) +
  facet_wrap(~statut_cas_temoin) +
  geom_bar(position="dodge")
```

```{r}
ggplot(CancerPoumon, aes(x=exposition_domestique_fumee, fill=tabagisme)) +
  facet_wrap(~statut_cas_temoin) +
  geom_bar(position="dodge")
```

```{r}
ggplot(CancerPoumon, aes(x=sexe, fill=bronchopneumopathie_chronique)) +
  facet_wrap(~statut_cas_temoin) +
  geom_bar(position="dodge")
```

## Régression logistique

On appelle modèle logistique le modèle défini par :

$Y \in \{0,1\}, \quad X \in \mathbb{R}^p, \quad \exists \beta \in \mathbb{R}^p$, la vraisemblance conditionnelle de Y sachant X=x est :

$$
L(Y \mid X=x) = \mathcal{B}\Big(F(\langle \beta, x \rangle)\Big),
$$ 

et on a :
$$
f_{\beta,x}(y) = F(\langle \beta, x \rangle)^y \, \big( 1 - F(\langle \beta, x \rangle) \big)^{1-y}, \quad y \in \{0,1\},
$$

où F est la fonction logistique : 
$$F(t) = \frac{e^t}{1+e^t} = \frac{1}{1+e^{-t}}.$$

**Interprétation des coefficients :**

On définit le log-odds comme :
$$ \ln \Big( \text{odds}\big(\mathbb{P}(Y=1 \mid X=x)\big) \Big) = \langle \beta, x \rangle $$

ou, $odds(A) = \frac{\mathbb{P}(A)}{1-\mathbb{P}(A)}$.

Chaque coefficient $\beta_j$ quantifie la variation du log-odds de Y=1 lorsque la variable $x_j$ augmente d'une unité, toutes les autres variables étant maintenues constantes :

$\text{Variation du log-odds : } \quad \ln(\text{odds}(Y=1 \mid x_j + 1)) - \ln(\text{odds}(Y=1 \mid x_j)) = \beta_j$

Pour une interprétation plus intuitive, on peut calculer $e^{\beta_j}$ qui correspond à l'odds ratio, il représente le facteur multiplicatif appliqué aux odds de Y=1 pour une augmentation de $x_j$.

# Régression logistique : cancer/tabac (K)

# Régression logistique : cancer quantitaive -\> age facteur de risque (C à déjà fait)

Les variables quantitatives sont "age" et "imc". On cherche a prédire la variable "statut_cas_temoin" que l'on va transformer en variable binaire valant 0 ou 1, c'est à dire "Cas"=1, et "temoin"=0.

Nous transformons également la variable "age", actuellement de type chaîne de caractères, en type numérique. Comme les décimales sont indiquées par une virgule, nous les remplaçons par un point afin que les valeurs soient valide.

```{r}
CancerPoumon$statut_cas_temoin <- ifelse(CancerPoumon$statut_cas_temoin=="Cas", 1, 0)
CancerPoumon <- CancerPoumon %>%
  mutate(age=as.numeric(str_replace(age, ",", ".")))
head(CancerPoumon)
```

On essaie tout d'abord des modèles univarié, un avec la variable "age" et un avec la variable "imc" :

```{r}
"Modèle avec imc :"
res_log_quanti1 <- glm(statut_cas_temoin ~ imc, family=binomial, data=CancerPoumon)
summary(res_log_quanti1)

"Modèle avec age :"
res_log_quanti2 <- glm(statut_cas_temoin ~ age, family=binomial, data=CancerPoumon)
summary(res_log_quanti2)
```

On va maintenant tester le modèle additif avec les variables "age" et "imc". On testera aussi le modèle avec un effet d’interaction entre "age" et "imc".

```{r}
"Modèle age + imc :"
res_log_quanti3 <- glm(statut_cas_temoin ~ age + imc, family=binomial, data=CancerPoumon)
summary(res_log_quanti3)

"Modèle avec age*imc :"
res_log_quanti4 <- glm(statut_cas_temoin ~ age*imc, family=binomial, data=CancerPoumon)
summary(res_log_quanti4)
```

Grâce a l'AIC on va determiner quel modèle est le meilleurs :

```{r}
AIC(res_log_quanti1, res_log_quanti2, res_log_quanti3, res_log_quanti4)

"Significativité du modèle :"
anova(res_log_quanti3, test = "Chisq")
```

Le modèle qui a l'AIC le plus faible est le modèle additif avec "age" et "imc" :
$ln(odds(\text{statut_cas_temoin=1 | } age=x_1 \text{, } imc=x_2))=\mu + \beta_{age} \times x_1 + \beta_{imc} \times x_2$
De plus, ce modèle est significatif. On va donc interpréter les résultats de ce modèle :

```{r}
"Le modèle :"
res_log_quanti3

"Intervalle de confiance :"
confint(res_log_quanti3)
```

On a donc $\hat{\beta}_{age} = 0.1075$ et $\hat{\beta}_{imc} = -0.1251$.

Les intervalles de confiance obtenus sont les suivant : $\beta_{age} \in [0.084, 0.133]$ $\beta_{imc} \in [-0.182, -0.070]$

Interpretation :

$0.084 \leq ln\Big(\frac{odds(statut-cas-temoin=1 \text{ | } age=x_1+1 \text{, } imc=x_2)}{odds(statut-cas-temoin=1 \text{ | } age=x_1 \text{, } imc=x_2)}\Big) \leq 0.133$

A imc fixé, avoir un âge plus élevé de 1 unité (1 ans), va multiplier l'odds d'avoir un cancer du poumon par au moins $e^{0.084} = 1.088$ et au plus $e^{0.133} = 1.142$.

$-0.182 \leq ln\Big(\frac{odds(statut_cas_temoin=1 \text{ | } age=x_1 \text{, } imc=x_2+1)}{odds(statut-cas-temoin=1 \text{ | } age=x_1 \text{, } imc=x_2)}\Big) \leq -0.070$

A age fixé, avoir un imc plus élevé de 1 unité, va diviser l'odds d'avoir un cancer du poumon par au moins $e^{0.070} = 1.072$ et au plus $e^{0.182} = 1.20$.

Un patient avec un âge plus élevé augmente significativement l'odds d'avoir un cancer du poumon, tandis qu'un patient avec un IMC plus élevé diminue significativement cet odds.

--> Donc l'age est un potentiel facteur de risque et l'imc plutôt un facteur protecteur.

# Régression logistique : cancer/IMC -\> qualitative (K)

# Régression logistique : cancer/tabac exposition pro, exposition domestique, age, brochopneumo (C)

Nous allons maintenant réaliser un modèle dans le but d'expliquer la variable "statut_cas_temoin", avec des variables explicatives quantitatives et qualitatives que nous pensons logique pour expliquer le cancer du poumon.

Nous avons choisi les variables "tabagisme", "exposition_professionnelle", "exposition_domestique_fumee", "bronchopneumopathie_chronique" et "age" :

```{r}
res <- glm(statut_cas_temoin ~ tabagisme + exposition_professionnelle + exposition_domestique_fumee + age + bronchopneumopathie_chronique, family=binomial, data=CancerPoumon)
summary(res)

"Test de significativité :"
anova(res, test="Chisq")

confint(res)
```

Le modèle est significatif comme on peut le voir dans le résultat du test anova.

On remarque que les modalités de réference sont : 
- "Ancien fumeur" pour la variable "tabagisme". 
- "Aucune exposition" pour lavariable "exposition_professionnelle". 
- "Non" pour lavariable "exposition_domestique_fumee". 
- "Non" pour la variable "bronchopneumopathie_chronique"

Interpretation des intervalles de confiance :

**Pour la variable "tabagisme" :**

À exposition professionnelle, exposition domestique à la fumée, âge et bronchopneumopathie chronique fixés, être fumeur actuel multiplie l'odds d'avoir un cancer du poumon par au moins $exp(1.154) = 3.171$ et au plus $exp(2.208) = 9.097$.

À exposition professionnelle, exposition domestique à la fumée, âge et bronchopneumopathie chronique fixés, n'avoir jamais fumée divise l'odds d'avoir un cancer du poumon par au moins $exp(0.022) = 1.022$ et au plus $exp(1.323) = 3.755$.

**Pour la variable "exposition_professionnelle" :**

À tabagisme, exposition domestique à la fumée, âge et bronchopneumopathie chronique fixés, une exposition professionnelle
faible multiplie l'odds d'avoir un cancer du poumon par au moins $exp(0.735) = 2.085$ et au plus $exp(1.832) = 6.246$.

À tabagisme, exposition domestique à la fumée, âge et bronchopneumopathie chronique fixés, une exposition professionnelle importante multiplie l'odds d'avoir un cancer du poumon par au moins $exp(1.436) = 4.204$ et au plus $exp(2.648) = 14.126$.

**Pour la variable "exposition_domestique_fumee" :**

À tabagisme, exposition professionnelle, âge et bronchopneumopathie chronique fixés, l'effet de l'exposition domestique à la fumée est non significatif car l'intervalle contient 0. De plus, si on regarde le résumer du modèle c'est la seule varaible qui n'a pas une p-value significative.

**Pour la variable "age" :**

À tabagisme, exposition professionnelle, exposition domestique à la fumée et bronchopneumopathie chronique fixés, avoir un ans
supplémentaire multiplie l'odds d'avoir un cancer du poumon par moins $exp(0.071) = 1.073$ et au plus $exp(0.127) = 1.135$.

**Pour la variable "bronchopneumopathie_chronique" :**

À tabagisme, exposition professionnelle, exposition domestique à la fumée et âge fixés, avoir une bronchopneumopathie chronique multiplie l'odds d'avoir un cancer par au moins $exp(0.904) = 2.469$ et au plus $exp(1.947) = 7.008$.

On peut donc dire que le cancer du poumon est principalement associé à l'exposition professionnelle importante, au tabagisme actuel et à la bronchopneumopathie chronique. L'âge est un facteur de risque plus faible mais significatif, tandis que n'avoir jamais fumé "agit"? comme un facteur protecteur. On peut également remarquer que l'arrêt du tabac est protecteur mais ne ramène pas au niveau de risque de quelqu'un n'ayant jamais fumé.

# Logistique multivarié AIC (prédiction sur cancer) -\> meilleur (K)

## Polytomique (on garde cas-témoins) (C)

On appelle modèle polytomique ordonnée le modèle défini par :

$X \in \mathbb{R}^p$ et Y est qualitative ordonnée de modalités $m_0 < m_1 < \text{. . .} < m_q$, on a
$(c_1, \text{ ... }, c_{q-1}) \in \mathbb{R}^{q-1} \text{ tq } \forall x \in \mathbb{R}^p \text{ et } \forall k=0, \text{ ... }, q-1 :$

$$
\mathbb{P}(Y = m_k \text{ | } X=x) = F(c_{k+1} - <\beta, x>) - F(c_{k} - <\beta, x>)
$$
ou F est toujours la fonction logistique.

Ce modèle est obtenu par une modèlisation par variable latente c'est-à-dire $Y = m_k \Leftrightarrow Y^* \in ]c_k, c_{k+1}]$, avec $c_0 = -\infty$ et $c_{q+1} = +\infty$. Une conséquence importante d'une modèlisation par variable latente est que peut importe la modalité $m_k$ choisit, l'interpretation sera la même !

Car on a pour odds-ratio :

$$ \frac{\text{odds}(Y \leq m_k \text{ | } X=x_j +1)}{\text{odds}(Y \leq m_k \text{ | } X=x_j)} = e^{-\beta_j}$$
et $e^{-\beta_j}$ ne dépend pas de $m_k$.

Il faut également faire attention lors de l'interprétation des coefficients a ne pas oublié le "-" devant le logarithme de l'odds ratio.

# polytomique ordonné : Exposition pro / sexe, région, age, niveau d'études, cas-témoins (K)

# polytomique ordonné : Exposition pro AIC (C)

On va maintenant regarder un modèle avec toute les variables de la table, sauf les variables "X" et "id_sujet" qui sont les 2 même et qui ne sont pas intéressante. Pour choisir le meilleur modèle on utilisé la fonction "stepAIC", toujours pour prédire "exposition_professionnelle" qui a pour modalités "Aucune exposition" \< "Exposition faible" \< "Exposition importante".

```{r}
CancerPoumon$statut_cas_temoin <- ifelse(CancerPoumon$statut_cas_temoin=="1", "Cas", "temoin")
res_poly <- polr(factor(exposition_professionnelle) ~ statut_cas_temoin + age + sexe + tabagisme + imc + bronchopneumopathie_chronique + niveau_etudes + exposition_domestique_fumee + region, data=CancerPoumon)

stepAIC(res_poly, direction="backward")
```

Le sous modèle avec la plus faible AIC est celui qui a pour variables explicatives "statut_cas_temoin".

```{r}
res_poly2 <- polr(factor(exposition_professionnelle) ~ statut_cas_temoin, data=CancerPoumon)
summary(res_poly2)

confint(res_poly2)
```

Interpretation :

$ -1.893 \leq -ln(\frac{odds(\text{expo_pro } \leq \text{ Exposition faible} \text{ | } statut=Temoin)}{odds(\text{tabagisme } \leq \text{ Fumeur actuel} \text{ | } statut=Cas)}) \leq -1.218 $

$ 1.218 \leq ln(\frac{odds(\text{expo_pro } \leq \text{ Exposition faible} statut=Temoin)}{odds(\text{tabagisme } \leq \text{ Fumeur actuel} \text{ | } statut=Cas)}) \leq 1.893 $

Par rapport aux cas, les témoins ont un odds d'être dans une catégorie d'exposition professionnelle inférieure ou égale à Exposition faible multiplié par au moins $exp(1.218) = 3.380$ et au plus$exp(1.893) = 6.639$.

--> Donc les témoins ont moins d'exposition professionnelle que les cas
(personne atteinte d'un cancer du poumon)

# Polytomique ordonné : tabac AIC (C à déjà fait)

On va mainatenant essayer de prédire la variable Y="tabagisme" qui a
trois modalités ordonnées : $"Ancien fumeur" \< "Fumeur actuel" \<"Jamais" : ou "Jamais" \< "Ancien fumeur" \< "Fumeur actuel" ???$

```{r}
res_poly3 <- polr(factor(tabagisme) ~ statut_cas_temoin + age + sexe + exposition_professionnelle + imc + bronchopneumopathie_chronique + niveau_etudes + exposition_domestique_fumee + region, data=CancerPoumon)

stepAIC(res_poly3, direction="backward")
```

Le sous modèle avec le plus faible AIC est celui qui a pour variables explicatives "statut_cas_temoin", "imc" et "region".

```{r}
res_poly4 <- polr(factor(tabagisme) ~ statut_cas_temoin + imc + region, data=CancerPoumon)
summary(res_poly4)

"Intervalles de confiance :"
confint(res_poly4)
```

Interpretation des coefficients :

**Pour la variable "statut_cas_temoin" :**

$ 0.025 \leq -ln(\frac{odds(\text{tabagisme } \leq \text{ Fumeur actuel} \text{ | } imc=x \text{, } region\text{, } statut=Temoin)}{odds(\text{tabagisme } \leq \text{ Fumeur actuel} \text{ | } imc=x \text{, } region \text{, } statut=Cas)}) \leq 0.666 $

$ -0.666 \leq ln(\frac{odds(\text{tabagisme } \leq \text{ Fumeur actuel} \text{ | } imc=x \text{, } region\text{, } statut=Temoin)}{odds(\text{tabagisme } \leq \text{ Fumeur actuel} \text{ | } imc=x \text{, } region \text{, } statut=Cas)})\leq -0.025 $

À imc et région fixés fixé, appartenir aux témoins, plutôt qu'aux cas divise l'odds d'être dans une catégorie de tabagisme inférieure ou égale à Fumeur actuel par au moins $exp(-0.666) = 0.514$ et au plus $exp(-0.025) = 0.975$.

**Pour la variable "imc" :**

$ -0.101 \leq -ln(\frac{odds(\text{tabagisme } \leq \text{ Fumeur actuel} \text{ | } imc=x+1 \text{, } region\text{, } statut)}{odds(\text{tabagisme } \leq \text{ Fumeur actuel} \text{ | } imc=x \text{, } region \text{, } statut)}) \leq -0.012 $

$ 0.012 \leq ln(\frac{odds(\text{tabagisme } \leq \text{ Fumeur actuel} \text{ | } imc=x+1 \text{, } region\text{, } statut)}{odds(\text{tabagisme } \leq \text{ Fumeur actuel} \text{ | } imc=x \text{, } region \text{, } statut)}) \leq 0.101 $

A région et statut_cas_temoin fixé, avoir un imc d'une unité en plus, multiplie l'odds d'être dans une catégorie de tabagisme inférieure ou égale à Fumeur actuel par au moins $exp(0.012) = 1.012$ et au plus $exp(0.101) = 1.106$.

**Pour la variable "region" :**

Pour la modalité "Haut-de-france" :

$ -0.859 \leq -ln(\frac{odds(\text{tabagisme } \leq \text{ Fumeur actuel} \text{ | } imc=x \text{, } region=Haut-de-france \text{, } statut)}{odds(\text{tabagisme } \leq \text{ Fumeur actuel} \text{ | } imc=x \text{, } region=Centre-Val-de-Loire \text{, } statut)}) \leq -0.092 $

$ 0.092 \leq ln(\frac{odds(\text{tabagisme } \leq \text{ Fumeur actuel} \text{ | } imc=x \text{, } region=Haut-de-france \text{, } statut)}{odds(\text{tabagisme } \leq \text{ Fumeur actuel} \text{ | } imc=x \text{, } region=Centre-Val-de-Loire \text{, } statut)}) \leq 0.859 $

A imc et statut_cas_temoin fixé, habité dans la région Haut-de-france, plutôt que dans la région Centre-Val-de-Loire multiplie l'odds d'être dans une catégorie de tabagisme inférieure ou égale à Fumeur actuel par au moins $exp(0.092) = 1.096$ et au plus $exp(0.859) = 2.360$.

Pour la modalité "Ile-de-France" :

$ -0.803 \leq -ln(\frac{odds(\text{tabagisme } \leq \text{ Fumeur actuel} \text{ | } imc=x \text{, } region=Ile-de-France  \text{, } statut)}{odds(\text{tabagisme } \leq \text{ Fumeur actuel} \text{ | } imc=x \text{, } region=Centre-Val-de-Loire \text{, } statut)}) \leq -0.058 $

$ 0.058 \leq ln(\frac{odds(\text{tabagisme } \leq \text{ Fumeur actuel} \text{ | } imc=x \text{, } region=Ile-de-France  \text{, } statut)}{odds(\text{tabagisme } \leq \text{ Fumeur actuel} \text{ | } imc=x \text{, } region=Centre-Val-de-Loire \text{, } statut)}) \leq 0.803 $

A imc et statut_cas_temoin fixé, habité dans la région Ile-de-France, plutôt que dans la région Centre-Val-de-Loire multiplie l'odds d'être dans une catégorie de tabagisme inférieure ou égale à Fumeur actuel par au moins $exp(0.058) = 1.060$ et au plus $exp(0.803) = 2.232$.

--> Moins de tabagisme si : on est témoin, on a un IMC plus élevé et si
on habite dans les Hauts-de-France ou en Ile-de-France.